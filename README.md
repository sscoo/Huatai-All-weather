# 全天候策略量化研究

本项目旨在通过量化方法，在中国市场环境下实现并优化一个基于宏观经济象限的风险平价全天候策略。

## 策略核心逻辑

全天候策略的核心思想是构建一个能够抵御不同经济环境（"季节"）变化的投资组合。本策略将其简化为四个宏观经济象限，并为每个象限分配一组能够在该环境下表现良好的资产（此处使用ETF代替）。

1.  **经济象限划分**:
    *   **经济增长上升 (高增长)**
    *   **经济增长下降 (低增长)**
    *   **通货膨胀上升 (高通胀)**
    *   **通货膨胀下降 (低通胀)**

2.  **风险平价配置**:
    *   在每个象限内部，采用风险平价（Risk Parity）原则进行资产配置。目标是使每项资产对该象限组合的总风险贡献相等。
    *   风险度量采用**指数加权移动平均半协方差 (EWMA Semi-Covariance)**，以更准确地捕捉资产价格的下行风险。

3.  **组合重构与再平衡**:
    *   根据预设的调仓频率（如每周、每月、每季度），定期对投资组合进行再平衡。
    *   在每次再平衡时，重新计算每个象限的风险，并调整资产权重，以确保风险贡献的均衡。
    *   交易成本（手续费）在回测中被考虑。

## 项目文件结构

```
.
├── 20250617 全天候策略/
│   ├── all_weather.py            # 主策略回测脚本
│   ├── parameter_optimization.py # 参数优化脚本
│   ├── data/                     # 存放资产价格数据的目录 (e.g., *.pkl)
│   ├── output/                   # 存放单次回测结果的目录
│   └── optimization_results/     # 存放参数优化结果的目录
├── .gitignore                    # Git忽略文件配置
└── README.md                     # 本说明文件
```

## 如何运行

### 1. 环境准备

请确保已安装必要的Python库。建议创建一个虚拟环境。

```bash
pip install pandas numpy matplotlib seaborn empyrical pyfolio
```

### 2. 数据准备

将获取到的资产日线行情数据（收盘价）分别保存为 `.pkl` 文件，并放置在 `data/` 目录下。文件名应与 `all_weather.py` 中 `ASSET_MAP` 字典的键一致。

### 3. 运行策略回测

直接运行主策略脚本：

```bash
python "20250617 全天候策略/all_weather.py"
```

回测结果（包括资产权重、组合表现、象限收益等CSV文件和一张策略分析图）将保存在 `output/` 目录下。

### 4. 运行参数优化

若要寻找最优参数组合，请运行参数优化脚本：

```bash
python "20250617 全天候策略/parameter_optimization.py"
```

该脚本将根据 `parameter_optimization.py` 中定义的 `PARAM_GRID` 进行网格搜索，并利用多核心并行计算加速。优化结果（包括所有参数组合的表现、参数统计摘要和一张分析图）将保存在 `optimization_results/` 目录下。

## 主要可配置参数

### `all_weather.py`

-   `START_DATE`, `END_DATE`: 回测的开始与结束日期。
-   `FEE_RATE`: 单边交易手续费率。
-   `EWMA_LAMBDA`: EWMA半衰期参数。
-   `WINDOW_MONTHS`: 计算风险所用的滚动窗口大小（月数）。
-   `REBALANCE_FREQ`: 调仓频率 ("W", "ME", "QE", "YE")。

### `parameter_optimization.py`

-   `PARAM_GRID`: 一个字典，定义了需要进行网格搜索的参数及其待选值。
-   `OPTIMIZATION_METRIC`: 用于评估和排序参数组合性能的主要指标（默认为 "Sharpe Ratio"）。
-   `TOP_N`: 在最终结果中，显示表现最好的 `N` 组参数。
-   `CPU_CORES`: 用于并行计算的CPU核心数（0表示使用所有核心）。 